<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liquid Glass Field Reporter</title>
    <!-- Load Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            /* Liquid Glass Gradient Background */
            background: linear-gradient(135deg, #1e3a8a 0%, #4f46e5 50%, #db2777 100%);
            min-height: 100vh;
        }

        /* Custom Shadow Classes for Liquid Depth */
        .shadow-glass-sm {
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(255, 255, 255, 0.1);
        }
        .shadow-glass-md {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.15);
        }
        .shadow-glass-lg {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.2);
        }

        /* Adjust main content padding to accommodate the fixed header and navbar */
        #app-container {
            padding-top: 100px; /* Space for Dynamic Island Header */
            padding-bottom: 96px; /* Space for fixed Nav Bar */
        }
        @media (min-width: 640px) {
            #app-container {
                padding-top: 24px;
            }
        }
    </style>
</head>
<body class="antialiased">
    <div id="root" class="min-h-screen flex flex-col">
        <!-- Application will be rendered here -->
    </div>

    <!-- Firebase SDK Imports (Module style required for modern use) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, query, addDoc, Timestamp, orderBy, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- Global Configuration ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        const PUBLIC_REPORTS_COLLECTION_PATH = `/artifacts/${appId}/public/data/liquid-reports-v2`; 

        let db = null;
        let auth = null;
        let isAuthReady = false;
        let currentReports = [];
        let currentPage = 'browse';
        let selectedReport = null; // for modal state

        // --- Utility Functions ---

        /**
         * @param {string} type 
         * @returns {{ icon: string, color: string, ring: string }}
         */
        const getTypeDetails = (type) => {
            switch (type) {
                case 'Water': return { icon: 'üíß', color: 'text-blue-400', ring: 'ring-blue-500/50' };
                case 'Energy': return { icon: '‚ö°', color: 'text-amber-400', ring: 'ring-amber-500/50' };
                case 'Health': return { icon: '‚ù§Ô∏è', color: 'text-pink-400', ring: 'ring-pink-500/50' };
                default: return { icon: 'üõ°Ô∏è', color: 'text-green-400', ring: 'ring-green-500/50' };
            }
        };

        const formatTimestamp = (timestamp) => {
            if (!timestamp || !timestamp.toDate) return 'Unknown Time';
            const date = timestamp.toDate();
            return date.toLocaleString('en-US', { 
                hour: '2-digit', minute: '2-digit', month: 'short', day: 'numeric', year: 'numeric' 
            });
        };

        const createElement = (tag, classes = '', content = '', attributes = {}) => {
            const el = document.createElement(tag);
            if (classes) el.className = classes;
            if (content) el.innerHTML = content;
            Object.keys(attributes).forEach(key => el.setAttribute(key, attributes[key]));
            return el;
        };

        const generateUUID = () => crypto.randomUUID();

        // --- Component Rendering Functions ---

        const renderDynamicIsland = () => {
            const now = new Date();
            const dateString = now.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
            
            // Mock Weather/Status Info
            const weather = {
                icon: '‚òÄÔ∏è',
                temp: '28¬∞C',
                color: 'text-amber-400'
            };

            const island = createElement('div', 'max-w-xs mx-auto flex items-center justify-between h-12 bg-white/20 backdrop-blur-xl rounded-full border border-white/40 shadow-glass-md px-5 space-x-4');
            
            const dateSection = createElement('div', 'flex items-center space-x-2');
            dateSection.append(
                createElement('span', 'text-xl', 'üóìÔ∏è'),
                createElement('span', 'text-sm font-semibold text-white tracking-wide', dateString)
            );

            const weatherSection = createElement('div', 'flex items-center space-x-1');
            weatherSection.append(
                createElement('span', 'text-xl', weather.icon),
                createElement('span', 'text-sm font-semibold text-white', weather.temp)
            );

            island.append(dateSection, weatherSection);

            const container = createElement('div', 'fixed top-0 left-0 right-0 z-20 pointer-events-none p-4 pt-8 pb-4 w-full');
            container.append(island);
            
            // Remove the pointer-events-none on the direct children to make links/buttons accessible
            island.classList.remove('pointer-events-none'); 

            return container;
        };

        const renderNavBar = () => {
            const nav = createElement('nav', 'fixed bottom-0 left-0 right-0 z-10');
            const inner = createElement('div', 'max-w-xl mx-auto p-3');
            const bar = createElement('div', 'flex justify-around items-center h-16 bg-white/20 backdrop-blur-xl rounded-full border border-white/40 shadow-glass-md');

            const createNavItem = (label, page) => {
                const isActive = currentPage === page;
                const iconMap = {
                    'Browse': 'üëÄ',
                    'Report': 'üìù',
                    'Contact': 'üìû'
                };

                const button = createElement('button', `flex flex-col items-center text-xs font-semibold p-2 rounded-full transition-all duration-300 w-1/4`, '', {
                    'data-page': page,
                    'aria-current': isActive ? 'page' : undefined,
                    'onclick': `window.setCurrentPage('${page}')`
                });

                if (isActive) {
                    button.classList.add('bg-white/80', 'text-gray-900', 'shadow-glass-sm');
                } else {
                    button.classList.add('text-white', 'hover:text-gray-200');
                }

                button.append(
                    createElement('span', 'w-6 h-6 text-xl', iconMap[label]),
                    createElement('span', 'mt-0.5', label)
                );
                return button;
            };

            bar.append(
                createNavItem('Browse', 'browse'),
                createNavItem('Report', 'report'),
                createNavItem('Contact', 'contact')
            );
            inner.append(bar);
            nav.append(inner);
            return nav;
        };

        const renderLoading = () => {
            return createElement('div', 'flex flex-col items-center justify-center h-full min-h-[300px] p-8 text-white', `
                <svg class="animate-spin h-8 w-8 text-white mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="font-semibold text-lg">Connecting to Real-time Data...</p>
            `);
        };

        const renderBrowseFeed = (reports) => {
            const container = createElement('div', 'p-4 space-y-6');
            container.innerHTML = `
                <h1 class="text-4xl font-extrabold text-white tracking-tight pt-2">Browse Reports</h1>
                <p class="text-gray-300 text-sm opacity-80">Tap on any report to view full details.</p>
                <!-- Search Input -->
                <div class="relative">
                    <span class="absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-white/70">üîç</span>
                    <input type="text" id="search-input" placeholder="Search location or type..." 
                        class="w-full py-3 pl-12 pr-4 rounded-full bg-white/20 backdrop-blur-md border border-white/30 text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/80 transition duration-300 shadow-glass-sm"
                    />
                </div>
                <!-- Filter Buttons -->
                <div class="flex flex-wrap gap-2 justify-start" id="filter-buttons"></div>
                <!-- Report Cards -->
                <div class="space-y-4" id="reports-list"></div>
            `;
            
            const filterContainer = container.querySelector('#filter-buttons');
            const types = ['All', 'Water', 'Energy', 'Health', 'Safety'];
            let currentFilter = 'All';
            let currentSearchTerm = '';

            const updateReportList = () => {
                const listContainer = container.querySelector('#reports-list');
                listContainer.innerHTML = '';
                
                const filteredReports = reports.filter(report => 
                    (currentFilter === 'All' || report.type === currentFilter) &&
                    (report.description.toLowerCase().includes(currentSearchTerm.toLowerCase()) ||
                     report.location.toLowerCase().includes(currentSearchTerm.toLowerCase()))
                );

                if (filteredReports.length === 0) {
                     listContainer.innerHTML = `
                        <div class="text-center py-12 bg-white/10 backdrop-blur-xl rounded-3xl border border-white/20 shadow-glass-md">
                            <span class="text-4xl block mb-3 text-white/70">üòû</span>
                            <p class="font-semibold text-xl text-white">No Active Reports</p>
                            <p class="text-sm text-gray-300">Share your observations using the Report tab.</p>
                        </div>
                    `;
                    return;
                }

                filteredReports.forEach(report => {
                    const { icon, color, ring } = getTypeDetails(report.type);
                    const card = createElement('div', 'bg-white/20 p-5 rounded-2xl backdrop-blur-lg border border-white/30 shadow-glass-md transition-all active:scale-[0.99] cursor-pointer hover:bg-white/30', '', {
                        'data-report-id': report.id
                    });

                    card.innerHTML = `
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center space-x-3">
                                <div class="p-2 rounded-full bg-white/90 ring-4 ${ring}">
                                    <span class="w-5 h-5 text-xl ${color}">${icon}</span>
                                </div>
                                <p class="text-lg font-bold text-white leading-snug">${report.type} Incident</p>
                            </div>
                            <p class="text-xs text-gray-300 opacity-70">${formatTimestamp(report.timestamp)}</p>
                        </div>
                        
                        <p class="text-sm font-semibold text-gray-200 mt-3 flex items-center">
                            <span class="inline w-4 h-4 mr-2 text-pink-400 flex-shrink-0">üìç</span>
                            ${report.location}
                        </p>
                        <p class="text-sm text-gray-300 mt-2 line-clamp-2">${report.description}</p>
                    `;

                    card.addEventListener('click', () => window.handleReportClick(report));
                    listContainer.append(card);
                });
            };

            const renderFilters = () => {
                filterContainer.innerHTML = '';
                types.forEach(type => {
                    const isActive = currentFilter === type;
                    const button = createElement('button', `px-4 py-1.5 text-sm font-semibold rounded-full border border-white/40 transition-all duration-300 shadow-glass-sm`, type, {
                        'onclick': `window.setFilterType('${type}')`
                    });

                    if (isActive) {
                        button.classList.add('bg-white/70', 'text-gray-900', 'shadow-glass-lg');
                    } else {
                        button.classList.add('bg-white/10', 'text-white', 'hover:bg-white/20');
                    }
                    filterContainer.append(button);
                });
            };

            // Global functions for interaction
            window.setFilterType = (type) => {
                currentFilter = type;
                renderFilters();
                updateReportList();
            };

            window.handleSearchInput = (event) => {
                currentSearchTerm = event.target.value;
                updateReportList();
            };

            container.querySelector('#search-input').addEventListener('input', window.handleSearchInput);

            // Initial render
            renderFilters();
            updateReportList();
            
            return container;
        };
        
        const renderReportDetailModal = () => {
            if (!selectedReport) return null;

            const report = selectedReport;
            const { icon, color, ring } = getTypeDetails(report.type);
            
            const modal = createElement('div', 'fixed inset-0 z-50 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 transition-opacity duration-300');
            modal.addEventListener('click', window.handleCloseModal);

            const content = createElement('div', 'w-full max-w-lg bg-white/10 rounded-3xl p-6 backdrop-blur-xl shadow-glass-lg border border-white/30 text-white transition-transform duration-300 scale-100', '', {
                'onclick': 'event.stopPropagation()'
            });

            content.innerHTML = `
                <div class="flex justify-between items-start mb-6">
                    <div class="flex items-center space-x-3">
                        <div class="p-3 rounded-full bg-white/90 ring-4 ${ring}">
                            <span class="w-7 h-7 text-3xl ${color}">${icon}</span>
                        </div>
                        <h2 class="text-2xl font-bold leading-snug">${report.type} Incident</h2>
                    </div>
                    <button 
                        onclick="window.handleCloseModal()"
                        class="p-2 rounded-full bg-white/20 hover:bg-white/30 transition-colors text-white/80 border border-white/40"
                    >
                        &times;
                    </button>
                </div>

                <div class="space-y-4">
                    <div class="border-b border-white/20 pb-2">
                        <p class="text-sm font-medium text-gray-300 flex items-center mb-1">
                            <span class="w-4 h-4 mr-2 text-pink-400">üìç</span>
                            Location
                        </p>
                        <p class="text-lg font-bold">${report.location}</p>
                    </div>

                    <div class="border-b border-white/20 pb-2">
                        <p class="text-sm font-medium text-gray-300 flex items-center mb-1">
                            <span class="w-4 h-4 mr-2 text-pink-400">üïí</span>
                            Reported Time
                        </p>
                        <p class="text-lg font-bold">${formatTimestamp(report.timestamp)}</p>
                    </div>

                    <div>
                        <p class="text-sm font-medium text-gray-300 flex items-center mb-1">
                            <span class="w-4 h-4 mr-2 text-pink-400">üí¨</span>
                            Detailed Description
                        </p>
                        <p class="text-base text-white/90 leading-relaxed bg-white/5 p-3 rounded-xl border border-white/10 shadow-inner">
                            ${report.description}
                        </p>
                    </div>
                </div>
            `;
            modal.append(content);
            return modal;
        };

        const renderReportForm = () => {
            const container = createElement('form', 'p-4 space-y-6', '', { 'id': 'report-form' });
            container.innerHTML = `
                <h1 class="text-4xl font-extrabold text-white tracking-tight pt-2">Report Hazard</h1>
                <p class="text-gray-300 text-sm opacity-80">Submit your report to the network.</p>

                <div id="message-area"></div>

                <div class="bg-white/10 rounded-2xl backdrop-blur-xl shadow-glass-md p-5 space-y-4 border border-white/30">
                    <div class="space-y-1">
                        <label for="report-type" class="text-sm text-gray-300 font-semibold block">Incident Type</label>
                        <select id="report-type" class="w-full p-3 bg-white/20 backdrop-blur-md border border-white/30 text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/80 rounded-xl transition duration-300 shadow-glass-sm" style="appearance: none;">
                            <option value="Water" class="bg-gray-800 text-white">Water Hazard (Flood/Spill)</option>
                            <option value="Energy" class="bg-gray-800 text-white">Energy Failure (Fire/Power)</option>
                            <option value="Health" class="bg-gray-800 text-white">Health Emergency</option>
                            <option value="Safety" class="bg-gray-800 text-white">General Safety Threat</option>
                        </select>
                    </div>

                    <div class="space-y-1">
                        <label for="location" class="text-sm text-gray-300 font-semibold block">Location</label>
                        <input id="location" type="text" placeholder="Address or nearest landmark" 
                            class="w-full p-3 bg-white/20 backdrop-blur-md border border-white/30 text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/80 rounded-xl transition duration-300 shadow-glass-sm"
                        />
                    </div>
                </div>

                <div class="bg-white/10 rounded-2xl backdrop-blur-xl shadow-glass-md p-5 space-y-2 border border-white/30">
                    <label for="description" class="text-sm text-gray-300 font-semibold block">Description</label>
                    <textarea id="description" rows="4" placeholder="Describe the situation clearly..." 
                        class="w-full p-3 bg-white/20 backdrop-blur-md border border-white/30 text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/80 rounded-xl transition duration-300 shadow-glass-sm resize-none"
                    ></textarea>
                </div>

                <button type="submit" id="submit-button" class="w-full py-4 px-4 rounded-full font-bold text-lg transition duration-300 transform shadow-glass-lg active:scale-[0.98] bg-white text-gray-900 hover:bg-gray-100">
                    Submit Report Anonymously
                </button>
            `;

            container.addEventListener('submit', handleReportSubmit);
            return container;
        };
        
        const renderContactPage = () => {
            const container = createElement('div', 'p-4 space-y-6');
            container.innerHTML = `
                <h1 class="text-4xl font-extrabold text-white tracking-tight pt-2">Contact Info</h1>
                <p class="text-gray-300 text-sm opacity-80">Essential contacts and platform information.</p>
                
                <div class="bg-white/10 rounded-2xl backdrop-blur-xl shadow-glass-md p-5 space-y-4 border border-white/30">
                    <p class="text-xl font-bold text-white border-b border-white/30 pb-3 flex items-center">
                        <span class="w-6 h-6 mr-3 text-white/80">üìû</span>
                        Emergency Contacts
                    </p>
                    ${renderContactLink("IMMEDIATE EMERGENCY (Police / Fire / Medical)", "911", "text-red-400", "üö®", true)}
                    ${renderContactLink("LOCAL COORDINATION CENTER", "(555) 123-4567", "text-blue-400", "üõ°Ô∏è", false)}
                </div>

                <div class="bg-white/10 rounded-2xl backdrop-blur-xl shadow-glass-md p-5 space-y-3 border border-white/30">
                    <p class="text-xl font-bold text-white border-b border-white/30 pb-3">
                        About This Platform
                    </p>
                    <p class="text-base text-gray-300">
                        This network uses public, real-time data to help the community. All reports are anonymous and shared globally. Data persistence is managed via secure cloud services (Firebase).
                    </p>
                    <p class="text-xs text-gray-400 pt-3 border-t border-white/30">
                        Warning: Always contact official emergency services first in life-threatening situations.
                    </p>
                </div>
            `;
            return container;
        };

        const renderContactLink = (title, detail, color, icon, isCritical) => {
            return `
                <div class="flex items-center space-x-3 p-3 rounded-xl bg-white/10 hover:bg-white/20 transition-colors cursor-pointer border border-white/20 ${isCritical ? 'ring-2 ring-red-500/50' : ''}">
                    <div class="p-2 rounded-full ${isCritical ? 'bg-red-500/70' : 'bg-white/90'}">
                        <span class="w-6 h-6 text-2xl ${color} flex-shrink-0">${icon}</span>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm text-gray-300 font-semibold">${title}</p>
                        <p class="text-xl font-extrabold text-white">${detail}</p>
                    </div>
                </div>
            `;
        };

        // --- Core Application Logic ---

        const renderApp = () => {
            const root = document.getElementById('root');
            root.innerHTML = ''; // Clear existing content

            // 1. Render Fixed Components
            root.append(renderDynamicIsland());
            root.append(renderNavBar());

            // 2. Render Main Content Area
            const mainContainer = createElement('main', 'flex-grow max-w-xl mx-auto w-full');
            mainContainer.id = 'app-container';
            root.append(mainContainer);

            // 3. Render Current Page
            let pageContent;
            if (!isAuthReady) {
                pageContent = renderLoading();
            } else {
                switch (currentPage) {
                    case 'report':
                        pageContent = db ? renderReportForm() : createElement('p', 'p-4 text-red-400 font-bold', 'Error: Database connection failed.');
                        break;
                    case 'contact':
                        pageContent = renderContactPage();
                        break;
                    case 'browse':
                    default:
                        pageContent = renderBrowseFeed(currentReports);
                        break;
                }
            }
            mainContainer.append(pageContent);
            
            // 4. Render Modal (if necessary)
            const modal = renderReportDetailModal();
            if (modal) {
                root.append(modal);
            }
        };

        window.setCurrentPage = (page) => {
            if (currentPage !== page) {
                currentPage = page;
                renderApp();
            }
        };
        
        window.handleReportClick = (report) => {
            selectedReport = report;
            renderApp(); // Rerender to show modal
        };

        window.handleCloseModal = () => {
            selectedReport = null;
            renderApp(); // Rerender to hide modal
        };

        const displayMessage = (type, text) => {
            const messageArea = document.getElementById('message-area');
            if (!messageArea) return;
            
            const classes = type === 'success' 
                ? 'bg-green-500/20 text-white border-green-400' 
                : 'bg-red-500/20 text-white border-red-400';
            const icon = type === 'success' ? '‚úÖ' : 'üö®';

            messageArea.innerHTML = `
                <div class="p-4 rounded-xl text-base font-semibold border-l-4 backdrop-blur-xl shadow-glass-md flex items-center ${classes}">
                    <span class="w-5 h-5 mr-3">${icon}</span>
                    ${text}
                </div>
            `;
            // Clear message after 5 seconds
            setTimeout(() => { messageArea.innerHTML = ''; }, 5000);
        };

        const handleReportSubmit = async (event) => {
            event.preventDefault();

            const submitButton = document.getElementById('submit-button');
            const type = document.getElementById('report-type').value;
            const location = document.getElementById('location').value.trim();
            const description = document.getElementById('description').value.trim();

            if (!location || !description) {
                displayMessage('error', 'Location and Description are mandatory fields.');
                return;
            }

            submitButton.disabled = true;
            submitButton.innerHTML = `<svg class="animate-spin h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Sending Data...`;

            const newReport = {
                type: type,
                location: location,
                description: description,
                timestamp: Timestamp.now(),
            };

            try {
                await addDoc(collection(db, PUBLIC_REPORTS_COLLECTION_PATH), newReport);
                displayMessage('success', 'Report successfully submitted. Thank you.');
                document.getElementById('location').value = '';
                document.getElementById('description').value = '';
            } catch (error) {
                console.error("Error submitting report: ", error);
                displayMessage('error', 'Submission failed. Check your connection.');
            } finally {
                submitButton.disabled = false;
                submitButton.innerHTML = 'Submit Report Anonymously';
            }
        };

        // --- Initialization ---

        const initializeFirebase = async () => {
            if (!firebaseConfig) {
                console.error("Firebase config is missing.");
                isAuthReady = true;
                renderApp();
                return;
            }

            try {
                const app = initializeApp(firebaseConfig);
                setLogLevel('debug');
                
                auth = getAuth(app);
                db = getFirestore(app);

                // Authentication Setup
                try {
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }
                } catch (error) {
                    console.error("Firebase Auth Error:", error);
                    await signInAnonymously(auth); 
                }

                onAuthStateChanged(auth, (user) => {
                    isAuthReady = true;
                    // Start data listener once authenticated
                    if (user) {
                        setupDataListener();
                    } else {
                        renderApp();
                    }
                });

            } catch (error) {
                console.error("Error initializing Firebase:", error);
                isAuthReady = true;
                renderApp();
            }
        };

        const setupDataListener = () => {
            const q = query(
                collection(db, PUBLIC_REPORTS_COLLECTION_PATH),
                orderBy('timestamp', 'desc')
            );

            onSnapshot(q, (snapshot) => {
                currentReports = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                // Only rerender the feed if we are on the browse page
                if (currentPage === 'browse') {
                    renderApp();
                }
            }, (error) => {
                console.error("Error listening to reports:", error);
            });
            renderApp(); // Initial render once data listener is set up
        };
        
        // Initial setup on window load
        window.onload = () => {
            initializeFirebase();
            // Update the dynamic island date/time every minute
            setInterval(renderApp, 60000); 
        };

        // Initial loading render before Firebase is ready
        renderApp();
    </script>
</body>
</html>

