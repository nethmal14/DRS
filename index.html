<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Liquid Audio Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- YouTube API -->
<script src="https://www.youtube.com/iframe_api"></script>

<style>
:root{
  --glass: rgba(255,255,255,0.14);
  --border: rgba(255,255,255,0.25);
}
html,body{
  margin:0;
  height:100%;
  background:black;
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display";
  overflow:hidden;
  color:white;
}

/* ===== BACKGROUND ===== */
#bg{
  position:fixed;
  inset:0;
  filter: blur(50px) saturate(180%);
  z-index:-1;
}
.orb{
  position:absolute;
  width:420px;
  height:420px;
  border-radius:50%;
  background:radial-gradient(circle at 30% 30%, #9fdcff, transparent 60%);
  transition: transform 0.6s ease;
}
.orb.pink{background:radial-gradient(circle at 30% 30%, #ff9fdc, transparent 60%)}
.orb.green{background:radial-gradient(circle at 30% 30%, #9fffcb, transparent 60%)}

/* ===== LOGIN ===== */
#login{
  position:absolute; inset:0;
  display:flex; justify-content:center; align-items:center;
  backdrop-filter:blur(30px);
}
.card{
  background:var(--glass);
  border:1px solid var(--border);
  border-radius:26px;
  padding:24px;
  width:260px;
}
input,button{
  width:100%; margin-top:10px;
  padding:10px;
  border-radius:14px;
  border:none;
}

/* ===== PLAYER CARD ===== */
#playerCard{
  position:absolute;
  bottom:28px;
  left:50%;
  transform:translateX(-50%);
  width:320px;
  background:var(--glass);
  backdrop-filter:blur(25px);
  border:1px solid var(--border);
  border-radius:26px;
  padding:14px;
  display:none;
}
.controls{
  display:flex;
  justify-content:space-between;
}
.controls button{
  background:rgba(255,255,255,0.2);
  color:white;
}

/* ===== POPUP ===== */
#popup{
  position:absolute; inset:0;
  background:rgba(0,0,0,0.45);
  backdrop-filter:blur(25px);
  display:none;
}
.popup-card{
  background:var(--glass);
  border:1px solid var(--border);
  border-radius:26px;
  width:320px;
  margin:80px auto;
  padding:20px;
}
.playlist div{
  padding:8px;
  background:rgba(255,255,255,0.15);
  border-radius:12px;
  margin-top:6px;
  cursor:pointer;
}

/* ===== HIDDEN YT ===== */
#yt{
  width:1px;
  height:1px;
  opacity:0;
  pointer-events:none;
}
</style>
</head>

<body>

<div id="bg">
  <div class="orb"></div>
  <div class="orb pink"></div>
  <div class="orb green"></div>
</div>

<div id="login">
  <div class="card">
    <h3>Login</h3>
    <input id="u" placeholder="username">
    <input id="p" type="password" placeholder="password">
    <button onclick="login()">Enter</button>
  </div>
</div>

<div id="playerCard">
  <div class="controls">
    <button onclick="playPause()">‚ñ∂Ô∏é / ‚ùö‚ùö</button>
    <button onclick="next()">‚è≠</button>
    <button onclick="openPopup()">üîç</button>
  </div>
</div>

<div id="popup">
  <div class="popup-card">
    <input id="plInput" placeholder="YT playlist link">
    <button onclick="addPlaylist()">Add</button>
    <div class="playlist" id="list"></div>
  </div>
</div>

<div id="yt"></div>

<script>
/* ===== FIREBASE ===== */
firebase.initializeApp({
  apiKey: "AIzaSyAhgK_yy1gySmtKb6Y6NGbaBvVAk2XaT3A",
  authDomain: "trip-tracker-57ce0.firebaseapp.com",
  databaseURL: "https://trip-tracker-57ce0-default-rtdb.firebaseio.com",
  projectId: "trip-tracker-57ce0"
});
const db = firebase.database();

/* ===== LOGIN ===== */
const users={apple:"apple",orange:"orange",grape:"grape"};
let user=null;
function login(){
  if(users[u.value]===p.value){
    user=u.value;
    login.style.display="none";
    playerCard.style.display="block";
    load();
    askPermission();
  }else alert("Invalid");
}

/* ===== YOUTUBE ===== */
let player;
function onYouTubeIframeAPIReady(){
  player=new YT.Player("yt",{playerVars:{autoplay:0}});
}
function play(link){
  const id=new URL(link).searchParams.get("list");
  player.loadPlaylist({list:id});
}
function playPause(){
  player.getPlayerState()==1?player.pauseVideo():player.playVideo();
}
function next(){player.nextVideo();}

/* ===== PLAYLISTS ===== */
function addPlaylist(){
  db.ref("pl/"+user).push(plInput.value);
  plInput.value="";
}
function load(){
  db.ref("pl/"+user).on("value",s=>{
    list.innerHTML="";
    s.forEach(x=>{
      const d=document.createElement("div");
      d.textContent=x.val();
      d.onclick=()=>{play(x.val());popup.style.display="none";}
      list.appendChild(d);
    });
  });
}

/* ===== POPUP ===== */
function openPopup(){popup.style.display="block";}
popup.onclick=e=>{if(e.target==popup)popup.style.display="none";}

/* ===== PERMISSION PROMPT ===== */
function askPermission(){
  navigator.mediaDevices.getUserMedia({audio:true})
  .catch(()=>{});
}

/* ===== PSEUDO AUDIO REACTIVE ENGINE ===== */
setInterval(()=>{
  const energy=player?.getPlayerState()==1?1.4:1;
  document.querySelectorAll(".orb").forEach(o=>{
    o.style.transform=
      `translate(${Math.random()*200}px,${Math.random()*200}px) scale(${energy})`;
  });
},500);
</script>
</body>
</html>
